---
title: "[Blog] Custom: Embed Code-Runner (Last Update: 2025.08.10)"
author: zerogod
date: 2025-08-08 09:38 +0900
categories: [etc, Blog]
tags: [C/C++, run, compile, execution]
render_with_liquid: true
---
## ***Abstract***
포스트 소개에 앞서, GitHub Pages 설정 및 커스텀 관련 포스트는 국내 독자와 추후 문제 해결을 위해 한글로 작성하기로 하였다.  
이번 포스트에서는 블로그 내에 **Embed Code-Runner**를 삽입하고 사용하는 방법을 정리한다. Jekyll의 Chirpy 테마를 기준으로, 별도 컴파일/실행 과정 없이 코드 예제를 바로 실행할 수 있는 환경을 구축한다.

## ***1. Introduction***
C/C++ 포스트 등에서 코드 블럭을 작성할 때, 예제 코드를 실행하려면 복사 &rarr; 컴파일 &rarr; 실행 과정을 거쳐야 한다. 이 과정이 반복되면 불필요한 시간이 소요되고 독자 역시 직접 에디터(ex. Vscode)에 코드를 옮겨야 하는 번거로움이 있다.  
이를 해소하기 위해 블로그에 **Emebed Code-Runner**를 추가하면 포스트 내에서 바로 코드 수정 및 실행이 가능하다. 이를 통해
1. 포스트 내 코드 작성이 편리해지고
1. 독자가 별도의 개발 환경을 준비할 필요가 없으며
2. 코드 수정 후 즉시 결과를 확인할 수 있는
3. 학습 및 데모에 최적화된 환경을 제공할 수 있다. 

본 포스트에서는 [OneCompiler](https://onecompiler.com/apis)의 *Embed Editor*와 *Code Executon API*, [Monaco Editor](https://microsoft.github.io/monaco-editor/), [Netlify](https://app.netlify.com/)를 연동하여 구현하였으며 각각 코드 실행, 코드 에디터, 호스팅을 담당한다. 

## ***2. Organization***
1. **Embed Code-Runner** &mdash; 기능 소개 및 사용 예제
2. **Implementation** &mdash; 구성 요소 및 설정 방법
3. **Customizaton** &mdash; 스타일 및 추가 옵션
4. **References** &mdash; 참고 자료

---
## ***3. Sections***
### ***3.1. Embed Code-Runner***
`render_with_liquid:` 옵션을 `true`로 설정하고, 아래 Liquid 태그를 포스트에 삽입하면 **Embed Code-Runner**가 동작한다.
{% raw %}
```liquid
{% code_runner id="hello-1" language="cpp" filename="hello" %}
#include <iostream>
int main() {
  std::cout << "Hello, World!" << std::endl;
  return 0;
}
{% endcode_runner %}
```
{% endraw %}
위 코드를 적용하면, 다음과 같이 에디터와 실행 버튼이 자동으로 렌더링된다. 

{% code_runner id="hello-1" language="cpp" filename="hello" %}
#include <iostream>
int main() {
  std::cout << "Hello, World!" << std::endl;
  return 0;
}
{% endcode_runner %}

**Embed Code-Runner**의 주요 기능을 정리하면 다음과 같다.
1. Run ▶ 버튼 클릭 시 코드 컴파일 및 실행
2. 에디터 내 직접 편집 및 재실행
3. 자동 높이 조절: 에디터와 콘솔 높이 동적으로 변경
4. 스크롤 기능: 에디터, 콘솔 각각 스크롤 가능
5. 다양한 언어 지원: C/C++, Python, Java 등 [Code Execution APIs](https://onecompiler.com/apis/code-execution) 참고

추가 예제:  
1) python

{% code_runner id="py1" language="python" filename="python" %}
print("Hello, World!")
print(1 + 2)
{% endcode_runner %}

2) 100줄 이상 출력 테스트

{% code_runner id="loop1" language="cpp" filename="loop" %}
#include <cstdio>
int main() {
  for (int i = 1; i <= 100; ++i) {
    printf("Line %d\n", i);
  }
  return 0;
}
{% endcode_runner %}

3) 컴파일 에러

{% code_runner id="err1" language="cpp" filename="compile_error" %}
#include <cstdio>
int main() {
  print("Hello, World!")
  return 0;
}
{% endcode_runner %}

### ***3.2. Implementation***
구현은 다음 4단계로 나뉜다.
1. [**Netlify Functions(proxy)**](https://app.netlify.com/)
- OneCompiler API 호출을 proxy로 중계(CORS/키 보호).
- ONECOMPILER_API_KEY는 Netlify 환경변수로 보관, 클라이언트에 노출 금지.

2. **HTML (iframe 문서)**
- Monaco Editor 렌더링 + 테마/스크롤바/패딩/레이아웃 제어.
- postMessage 수신해 코드 실행 요청 처리 → Netlify 함수 호출 → 결과를 부모에 postMessage로 회신.

3. **JavaScript (부모 페이지 스크립트)**
- 임베드된 iframe과 양방향 메시징.
- Run 버튼 클릭 &rarr; iframe에 { type: 'run' } 전송
- iframe의 { type: 'run-result' } 수신 &rarr; 콘솔 영역에 출력.
- runnerId로 다중 인스턴스 충돌 방지.

4. **Jekyll Plugin (Liquid 태그)**
- 포스트 안에서 {% raw %} `{% code_runner id="id" language="cpp" filename="main" %} [code] {% endcode_runner %}` {% endraw %} 같은 단축 태그로 wrapper HTML + iframe src(+encoded code) + 콘솔 영역을 자동 생성.
- 빌드시 정적 치환이므로 배포가 간단하고, 포스트마다 옵션 주입 편리.

#### **3.2.1. Netlify**
1. [RapidAPI](https://rapidapi.com/onecompiler-onecompiler-default/api/onecompiler-apis/pricing)에서 One Compiler Execution API를 활성화하고 API 키를 발급받는다. 
2. Netlify 프로젝트를 GitHub repository와 연동하여 생성한다.
3. Netlify 환경 변수(ONECOMPILER_API_KEY)로 API 키를 등록하여 배포한다.

Netlify를 이용한 proxy를 사용하는 이유는 API 키를 환경변수로 주입하는 단계에 문제가 있기 때문이다. 이를 해결하기 위해 proxy 서버를 경유하도록 구현하였으며 단순히 api 호출만을 경유하기 때문에 큰 delay가 발생하지는 않았다.   
proxy 서버의 구현은 [code-runner-proxy](https://github.com/code0-god/code-runner-proxy.git)를 참고하라.

#### ***3.2.2. JavaScript***
```js
// assets/js/code_runner.js
(function () {
  console.log('[parent] code_runner.js loaded');
  function getIframe(id) {
    return document.querySelector(`#editor-${id} iframe`);
  }

  function initRunners() {
    document.querySelectorAll('.code-runner-run').forEach(runBtn => {
      const id = runBtn.dataset.runnerId;
      runBtn.addEventListener('click', () => {
        console.log('[parent] Run clicked', id);
        const out = document.getElementById(`console-${id}`);
        out.textContent = 'Running…';
        const iframe = getIframe(id);
        if (iframe) {
          console.log('[parent] postMessage to iframe', id);
          iframe.contentWindow.postMessage({ type: 'run', id: id }, '*');
        } else {
          out.textContent = 'Error: editor iframe not found!';
        }
      });
    });
  }

  window.addEventListener('message', event => {
    console.log('[parent] got message:', event.data);
    if (event.data && event.data.type === 'run-result' && event.data.id) {
      const out = document.getElementById(`console-${event.data.id}`);
      if (out) out.textContent = event.data.output;
    }
  });

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initRunners);
  } else {
    initRunners();
  }
})();
```
#### **3.2.2. Html**
```html
<!-- embed/code_runner.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />
  <title>Code Runner</title>

  <style>
    /* 외부 스크롤 차단, Monaco 내부 스크롤만 사용 */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #1e1e1e;
      overflow: hidden;
    }

    /* 에디터 컨테이너(높이는 JS에서 제어) */
    #container {
      width: 100%;
      background: #1e1e1e;
    }

    /* 가로 스크롤 방지 */
    .monaco-editor .overflow-guard {
      overflow-x: hidden !important;
    }

    /* ───────────────────────────────────────────────
       Monaco 스크롤바 thumb 정확 타겟팅 + 전역 .slider 무력화
       구조: .monaco-scrollable-element .scrollbar > .slider
       ─────────────────────────────────────────────── */
    .monaco-editor .monaco-scrollable-element .scrollbar > .slider {
      background: rgba(128, 128, 128, 0.30) !important;
      border-radius: 3px !important;
    }
    .monaco-editor .monaco-scrollable-element .scrollbar:hover > .slider {
      background: rgba(128, 128, 128, 0.50) !important;
    }
    .monaco-editor .monaco-scrollable-element .scrollbar > .slider.active {
      background: rgba(128, 128, 128, 0.70) !important;
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/loader.js"></script>
  <script>
    /* global require, monaco */

    require.config({
      paths: {
        vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs'
      }
    });

    require(['vs/editor/editor.main'], function () {
      const url = new URL(window.location.href);
      const lang = url.searchParams.get('lang') || 'cpp';
      let code = '';
      try {
        const raw = url.searchParams.get('code') || '';
        // URL 디코딩 → '+' 복원 → base64 디코딩
        const urlDecoded = decodeURIComponent(raw);
        const plusFixed  = urlDecoded.replace(/ /g, '+');
        code = atob(plusFixed);
      } catch (e) {
        console.warn('[embed] base64 decode failed:', e);
        code = ''; // 안전 폴백
      }
      const filename = url.searchParams.get('filename') || 'main.cpp';
      const runnerId = url.searchParams.get('id') || '';

      const MIN_HEIGHT = 50;
      const MAX_HEIGHT = 380;

      const container = document.getElementById('container');

      // 부모 .code-runner-editor의 --editor-vpad(px 환산)
      function getEditorVPadPx() {
        try {
          const iframeEl = window.frameElement;
          if (iframeEl && iframeEl.parentElement) {
            const host = iframeEl.parentElement; // .code-runner-editor
            const parentWindow = (iframeEl.ownerDocument || document).defaultView;
            const cs = parentWindow.getComputedStyle(host);

            let val = cs.getPropertyValue('--editor-vpad').trim();
            if (!val) val = '0.75em'; // fallback

            const hostFontPx = parseFloat(cs.fontSize) || 16;
            if (val.endsWith('rem')) {
              const rootFs = parseFloat(
                parentWindow.getComputedStyle(
                  (iframeEl.ownerDocument || document).documentElement
                ).fontSize
              ) || 16;
              return Math.round(parseFloat(val) * rootFs);
            }
            if (val.endsWith('em')) {
              return Math.round(parseFloat(val) * hostFontPx);
            }
            if (val.endsWith('px')) {
              return Math.round(parseFloat(val));
            }
            const n = parseFloat(val);
            return Number.isNaN(n) ? 12 : Math.round(n);
          }
        } catch (e) {}
        return 12;
      }

      // 회색 계열 스크롤바(테마 토큰)
      monaco.editor.defineTheme('my-dark', {
        base: 'vs-dark',
        inherit: true,
        rules: [],
        colors: {
          'scrollbarSlider.background':       'rgba(128,128,128,0.30)',
          'scrollbarSlider.hoverBackground':  'rgba(128,128,128,0.50)',
          'scrollbarSlider.activeBackground': 'rgba(128,128,128,0.70)',
          'editorScrollbar.shadow':           '#00000000'
        }
      });
      monaco.editor.setTheme('my-dark');

      const vpad = getEditorVPadPx();

      // Monaco 생성: 내부 padding만 사용(겉 컨테이너 패딩은 0)
      window.editor = monaco.editor.create(container, {
        value: code,
        language: lang,
        theme: 'my-dark',
        automaticLayout: false,
        minimap: { enabled: false },
        wordWrap: 'on',
        renderLineHighlight: 'none',
        scrollBeyondLastLine: false,
        padding: { top: vpad, bottom: vpad },
        scrollbar: {
          vertical: 'auto',
          horizontal: 'hidden',
          verticalScrollbarSize: 6,
          horizontalScrollbarSize: 6,
          handleMouseWheel: true,
          useShadows: false
        }
      });

      function resizeToFit() {
        const contentHeight = window.editor.getContentHeight();
        const bounded = Math.max(MIN_HEIGHT, Math.min(contentHeight, MAX_HEIGHT));

        window.editor.layout({
          width: window.editor.getLayoutInfo().width,
          height: bounded
        });

        container.style.height = String(bounded) + 'px';

        if (window.parent && window.frameElement) {
          window.frameElement.style.height = String(bounded + 2) + 'px';
        }
      }

      window.editor.onDidContentSizeChange(resizeToFit);
      resizeToFit();

      // 실행 요청 처리 (부모 → 자식)
      window.addEventListener('message', function (event) {
        const data = event.data;
        if (!data || data.type !== 'run' || data.id !== runnerId) return;

        const codeToRun = window.editor.getValue();

        fetch('https://ornate-beijinho-0548f2.netlify.app/.netlify/functions/run-code', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            language: lang,
            version: 'latest',
            files: [{ name: filename, content: codeToRun }]
          })
        })
        .then(function (res) { return res.json(); })
        .then(function (j) {
          const output = j.stdout || j.output || j.errors || j.stderr || 'No output';
          window.parent.postMessage(
            { type: 'run-result', id: runnerId, output: output },
            '*'
          );
        })
        .catch(function (e) {
          window.parent.postMessage(
            { type: 'run-result', id: runnerId, output: 'Error: ' + e.message },
            '*'
          );
        });
      }, false);
    });
  </script>
</head>
<body>
  <div id="container"></div>
</body>
</html>
```

```html
<!-- head.html --> 
  <!-- Scripts -->

  <script src="{{ '/assets/js/dist/theme.min.js' | relative_url }}"></script>
  
  <!-- Code Runner 추가 -->
  <script src="{{ '/assets/js/code_runner.js' | relative_url }}"></script> 
```

```yml
# _config.yml
# 다음을 추가
include:
  - embed
```

#### ***3.2.3. Jekyll Plugin***
{% raw %}
```ruby
# _plugins/code_runner.rb
require 'cgi'
require 'base64'

module Jekyll
  class CodeRunnerBlock < Liquid::Block
    SYNTAX = /(id="([^"]+)"\s+language="([^"]+)"(?:\s+filename="([^"]+)")?)/

    def initialize(tag_name, markup, tokens)
      super
      unless markup =~ SYNTAX
        raise SyntaxError,
          "Valid syntax: {% code_runner id=\"foo\" language=\"cpp\" [filename=\"bar\"] %}"
      end
      @id, @language, @filename = $2, $3, $4
    end

    def render(context)
      code = super.strip
      fname = @filename.to_s.empty? ? "main.#{@language}" : @filename.include?('.') ? @filename : "#{@filename}.#{@language}"
      raw_b64     = Base64.strict_encode64(code)
      encoded_code = CGI.escape(raw_b64)
      iframe = <<~IFRAME
        <iframe class="code-runner-iframe"
          src="/embed/code_runner.html?id=#{@id}&lang=#{@language}&code=#{encoded_code}&filename=#{CGI.escape(fname)}"
          width="100%" height="100%" style="width:100%;height:100%;border:0;padding:0;display:block;"
          frameborder="0"
          allow="clipboard-write"
        ></iframe>
      IFRAME

      <<~HTML
        <div class="code-runner-wrapper" id="runner-#{@id}">
          <div class="code-runner-header">
            <span class="code-runner-filename">#{fname}</span>
            <button class="code-runner-run" data-runner-id="#{@id}">Run ▶</button>
          </div>
          <div id="editor-#{@id}" class="code-runner-editor">
            #{iframe}
          </div>
          <pre id="console-#{@id}" class="code-runner-console">Click Run ▶</pre>
        </div>
      HTML
    end
  end
end

Liquid::Template.register_tag('code_runner', Jekyll::CodeRunnerBlock)
```
{% endraw %}

### ***3.3. Customization***
#### **3.3.1. head.html**
*code_runner.js* 사용을 위해 head.html에서 `<script src="{{ '/assets/js/dist/theme.min.js' | relative_url }}"></script>
` 아래 다음 script를 추가한다

```html
  <!-- Scripts -->

  <script src="{{ '/assets/js/dist/theme.min.js' | relative_url }}"></script>
  
  <!-- Code Runner 추가 -->
  <script src="{{ '/assets/js/code_runner.js' | relative_url }}"></script> 
```

#### **3.3.2. CSS**
```scss
// _sass/_code-runner.scss
.code-runner-wrapper {
  border: 1px solid #444;
  border-radius: 8px;
  background: #232323;
  overflow: hidden;
  margin-bottom: 2em;
  box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  display: flex;
  flex-direction: column;
}

/* ─── HEADER ─── */
.code-runner-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.6em 1em;
  background: linear-gradient(135deg, #2b2b2b, #1f1f1f);
  border-bottom: 1px solid #555;
}

.code-runner-filename {
  font-family: 'Source Code Pro', monospace;
  font-size: 1em;
  font-weight: 500;
  color: #e0e0e0;
  user-select: none;
  margin: 0;
}

.code-runner-run {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.5em 0.8em;
  line-height: 1;
  background: #d43f5a;
  color: #fff;
  border: 1px solid #ad3246;
  border-radius: 4px;
  font-size: 0.8em;
  font-weight: 500;
  cursor: pointer;
  transition: background .2s, border-color .1s;

  &:hover {
    background: #ad3246;
    border-color: #8b2938;
  }
}

/* ─── EDITOR ───
   겉 컨테이너 패딩은 0으로 두고, padding은 Monaco 내부에서만 사용.
   --editor-vpad 값은 iframe이 읽어 내부 padding(top/bottom)에 동일하게 적용. */
.code-runner-editor {
  --editor-vpad: 0.75em; /* 원하는 상/하 패딩 */
  background: #1e1e1e;
  padding: 0;            /* 겉 패딩 제거 (일관성 확보) */
  min-height: 50px;
  max-height: 380px;
  position: relative;
  overflow: hidden;      /* 스크롤은 Monaco 내부에서 처리 */
  box-sizing: border-box;
}

/* ─── CONSOLE ─── */
.code-runner-console {
  padding: 1rem;
  background: #111;
  color: #0f0;
  font-family: monospace;
  font-size: 0.8em;
  border-top: 1px solid #555;
  min-height: 100px;
  max-height: 200px;
  overflow: auto;

  /* 네이티브 스크롤바(콘솔) 스타일 */
  &::-webkit-scrollbar { width: 6px; }
  &::-webkit-scrollbar-thumb {
    background: #555;
    border-radius: 3px;
  }
  scrollbar-width: thin;
  scrollbar-color: #555 #111;
}
```

생성한 css를 `main.scss`에 추가해주면 Embed Code-Runner가 적용된다.
```scss
// main.scss
@forward 'base';
@forward 'components';
@forward 'layout';
@forward 'pages';
@forward "code-runner"; // 추가
```

### ***3.4. References***
1. [OneCompiler](https://onecompiler.com/)
2. [Monaco Editor를 활용해서 React 기반 프로젝트에 코드 에디터 적용하기!](https://mingule.tistory.com/75)
3. [Monaco Editor](https://microsoft.github.io/monaco-editor/)
4. [Netlify](https://app.netlify.com/)